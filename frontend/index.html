<!DOCTYPE html> 
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E_Commerce_App</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap" rel="stylesheet">
</head>

<body>
    <div class = "container">
        <div class="slides slide1">
            <div class="rectangle-1">
                <button class="login-button" onclick="window.location.href='sign-up.html'">
                    <img class="login-icon" src="images/my-account-login.png" alt="Shopping Cart">
                </button>
                <button class="cart-button" onclick="window.location.href='cart.html'">
                    <img class="cart-icon" src="images/shopcart.png" alt="Shopping Cart">
                </button>
            </div>
            <h1> IN <br>
            Store
            </h1>
        </div>
        <div class="slides slide2">
            <div class=" rectangle-2">
               <h2> Embrace the softness, feel the magic—because every plush <br>
                            holds a little love and endless memories!</h2>
            </div>
            <h3> Check out our Products!</h3>
            
            <div class="products-container"> <div class="product-grid" id="productGrid"></div>
        </div>

            <div class="circle1"></div>
            <div class="circle2"></div>
            <div class="circle3"></div>
        </div>
        <div class="slides slide3">
            <img src = "images/pngtree-teddy-bear-cartoon-png-image_10166896.png">
            <h4> Thank YOU!</h4>
        </div>
    </div>


    <script>
       const backendUrl = "http://EC-LB-1780375435.eu-north-1.elb.amazonaws.com:80";
       
    
        // Função para obter token do localStorage
        function getToken() {
            return localStorage.getItem("token");
        }

        function fetchProducts() {
            console.log("A função fetchProducts() foi chamada!");
            fetch(`${backendUrl}/products`)
                .then(response => response.json())
                .then(products => {
                    productGrid.innerHTML = ''; // Limpa o conteúdo anterior
                    let productCount = 0;
                    console.log(products);
                    productGrid = document.getElementById("productGrid");

                    products.forEach(product => {
                        if (productCount < 9) {
                            const productDiv = document.createElement('div');
                            productDiv.classList.add('product');
                            productDiv.classList.add(`product${product.id}`); // Adiciona uma classe única

                            const img = document.createElement('img');
                            img.src = product.imageUrl; // Usa o URL da imagem retornado pelo backend
                            img.alt = product.name;

                            const name = document.createElement('h4'); // Adiciona o nome do produto
                            name.textContent = product.name;

                            const price = document.createElement('p');
                            price.classList.add('price');
                            price.textContent = `$${product.price.toFixed(2)}`;

                            const addButton = document.createElement('button');
                            addButton.classList.add('addToCart');
                            addButton.dataset.productId = product.id;
                            addButton.textContent = 'Add To Cart';
                            addButton.addEventListener('click', () => addToCart(product.id));

                            const stock = document.createElement('p');
                            stock.classList.add('stock');
                            stock.textContent = 'In Stock'; // Assumindo que todos estão em stock inicialmente

                            productDiv.appendChild(img);
                            productDiv.appendChild(name); // Adiciona o nome ao div do produto
                            productDiv.appendChild(price);
                            productDiv.appendChild(addButton);
                            productDiv.appendChild(stock);

                            productGrid.appendChild(productDiv);
                            productCount++;
                        }
                    });
                })
                .catch(error => console.error("Erro ao buscar produtos:", error));
        }
    
        function addToCart(productId) {
            const token = getToken();
    
            if (!token) {
                alert("Por favor, faça login primeiro.");
                return;
            }
    
            fetch(`${backendUrl}/addToCart`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify({ product_id: productId })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            })
            .catch(error => console.error("Erro ao adicionar ao carrinho:", error));
        }
    
        document.addEventListener("DOMContentLoaded", function() {
            const buttons = document.querySelectorAll(".addToCart");
            buttons.forEach(button => {
                button.addEventListener("click", () => {
                    const productId = button.getAttribute("data-product-id");
                    addToCart(productId);
                });
            });

            fetchProducts(); 
        });
    </script>

</body>
</html>